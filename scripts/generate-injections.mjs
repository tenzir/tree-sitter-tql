#!/usr/bin/env node
import { existsSync, mkdirSync, writeFileSync } from "fs";
import { dirname, resolve } from "path";
import { fileURLToPath } from "url";

const __dirname = dirname(fileURLToPath(import.meta.url));
const repoRoot = resolve(__dirname, "..");

const injectionQuery = `;; Auto-generated by tenzir/tree-sitter-tql/scripts/generate-injections.mjs. DO NOT EDIT.\n\n;; Highlight YAML frontmatter using the YAML grammar.\n\n(frontmatter\n  body: (frontmatter_body) @injection.content\n  (#set! injection.language "yaml")\n  (#set! injection.combined)\n  (#set! injection.include-children))\n`;

function main() {
  const args = process.argv.slice(2);
  const outputs = args.length > 0
    ? args
    : [
        "languages/tql/injections.scm",
        "queries/tql/injections.scm",
      ];

  for (const outputArg of outputs) {
    const outputPath = resolve(repoRoot, outputArg);
    const outputDir = dirname(outputPath);
    if (!existsSync(outputDir)) {
      mkdirSync(outputDir, { recursive: true });
    }
    writeFileSync(outputPath, injectionQuery, "utf8");
    console.log(`Wrote ${outputPath}`);
  }
}

main();
